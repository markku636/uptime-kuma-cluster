### Kuma API 測試範例

# 基礎 URL 變數
@baseUrl = http://localhost:8084
# http://localhost:8084/
@apiKey = uk4_scu5NRFWKpk4ZGB0kpjkcl3v2iJ4yEkBlMou5C6t

### 測試 API 狀態
GET {{baseUrl}}/api/v1/status

### 取得所有 monitors
GET {{baseUrl}}/api/v1/monitors
Authorization: {{apiKey}}

### 取得指定 monitor (ID = 1)
GET {{baseUrl}}/api/v1/monitors/242
Authorization: {{apiKey}}

### 建立 HTTP 監控器
POST {{baseUrl}}/api/v1/monitors
Authorization: {{apiKey}}
Content-Type: application/json

{
  "name": "示例 HTTP 監控",
  "type": "http",
  "url": "https://httpbin.org/status/200",
  "interval": 60,
  "active": true,
  "retryInterval": 30,
  "timeout": 10,
  "method": "GET",
  "node_id": "node1",
  "description": "示例描述",
  "headers": { "apikey": "first" }
}
// node id 是後台的節點名稱，分片用途，一需要寫死 node1，不然服務不會被nod1 執行
### 更新 monitor (ID = 1)
PUT {{baseUrl}}/api/v1/monitors/28
Authorization: {{apiKey}}
Content-Type: application/json

{
  "name": "更新後名稱",
  "interval": 120,
  "description": "示例描述update",
  "headers": { "apikey": "update111" }
}

### 暫停 monitor (ID = 1)
PUT {{baseUrl}}/api/v1/monitors/1
Authorization: {{apiKey}}
Content-Type: application/json

{
  "active": false
}

### 刪除 monitor (ID = 1)
DELETE {{baseUrl}}/api/v1/monitors/1
Authorization: {{apiKey}}



### 取得所有狀態頁面
GET {{baseUrl}}/api/v1/status-pages
Authorization: {{apiKey}}

### 建立狀態頁面
POST {{baseUrl}}/api/v1/status-pages
Authorization: {{apiKey}}
Content-Type: application/json

{
  "title": "REST API 測試狀態頁面",
  "slug": "full-test-page-1",
  "description": "測試頁面",
  "autoRefreshInterval": 120,
  "published": true,
  "publicGroupList": [
    {
      "name": "服務群組",
      "monitorList": [
        { "id": 1, "sendUrl": false },
        { "id": 2, "sendUrl": false }
      ]
    }
  ]
}

### 更新狀態頁面 publicGroupList
PUT {{baseUrl}}/api/v1/status-pages/full-test-page
Authorization: {{apiKey}}
Content-Type: application/json

{
  "title": "REST API 測試狀態頁面",
  "slug": "full-test-page",
  "description": "測試頁面",
  "autoRefreshInterval": 120,
  "published": true,
  "publicGroupList": [
    {
      "name": "服務群組",
      "monitorList": [
        { "id": 1, "sendUrl": false },
        { "id": 2, "sendUrl": false }
      ]
    }
  ]
}
// 更新狀態頁面 publicGroupList ，id 是後台的監控器id，sendUrl 是是否發送url，false 是只發送狀態，true 是發送url和狀態

### 取得 monitor 心跳資料 (ID = 1)
GET {{baseUrl}}/api/v1/monitors/1/heartbeats?period=24
Authorization: {{apiKey}}

### ---------------
### OpenResty / 負載平衡 / 健康檢查相關測試
### 注意：所有 OpenResty API 都統一放在 /lb/ 路徑下
### ---------------

### 快速檢查 Nginx / OpenResty 是否存活
GET {{baseUrl}}/lb/ping

### 查詢 OpenResty 健康檢查統計資訊
GET {{baseUrl}}/lb/health-status

### 手動觸發一次健康檢查
POST {{baseUrl}}/lb/trigger-health-check

### 查詢集群節點狀態 (來自 DB node 表)
GET {{baseUrl}}/lb/health

### 查詢節點容量 / monitor 數量
GET {{baseUrl}}/lb/capacity

### 取得目前健康檢查調試設定
GET {{baseUrl}}/lb/debug-config

### 取得 OpenResty 調試日誌（僅限內網/測試環境使用，避免生產環境暴露過多資訊）
GET {{baseUrl}}/lb/debug-logs

### (向後兼容) 舊 /health 路徑會重定向到 /lb/ping
GET {{baseUrl}}/health

### ---------------
### 系統狀態 API | System Status APIs
### ---------------

### 綜合系統狀態（推薦）| System status (recommended)
GET {{baseUrl}}/lb/system-status

### 節點狀態 | Node status
GET {{baseUrl}}/lb/node-status

### 負載均衡狀態 | Load balancer status
GET {{baseUrl}}/lb/load-balancer-status

### 重新平衡狀態 | Rebalancing status
GET {{baseUrl}}/lb/rebalancing-status

### ---------------
### 固定節點路由 | Fixed Node Routing
### ---------------

### 列出所有可用節點 | List available nodes
GET {{baseUrl}}/lb/available-nodes

### 查看當前固定節點狀態 | View fixed node status
GET {{baseUrl}}/lb/fixed-node-status

### 設定固定節點為 node1（瀏覽器訪問）| Set fixed node to node1 (browser)
GET {{baseUrl}}/lb/fixed-node/node1

### 設定固定節點為 node2（瀏覽器訪問）| Set fixed node to node2 (browser)
GET {{baseUrl}}/lb/fixed-node/node2

### 設定固定節點為 node3（瀏覽器訪問）| Set fixed node to node3 (browser)
GET {{baseUrl}}/lb/fixed-node/node3

### 清除固定節點（瀏覽器訪問）| Clear fixed node (browser)
GET {{baseUrl}}/lb/clear-fixed-node

### 透過 API 設定固定節點 | Set fixed node via API
POST {{baseUrl}}/lb/set-fixed-node
Content-Type: application/json

{
  "node": "node2",
  "expires": 604800
}

### 透過 API 清除固定節點 | Clear fixed node via API
POST {{baseUrl}}/lb/clear-fixed-node
