# 調試日誌配置
# 將 DEBUG 級別的日誌分離到特定目錄

# 調試日誌格式
log_format debug_detailed '$time_local | $remote_addr | $request_method $request_uri | '
                          '$status | $body_bytes_sent | $request_time | '
                          'debug_level: "$http_x_debug_level" | '
                          'debug_module: "$http_x_debug_module" | '
                          'debug_info: "$http_x_debug_info"';

# 健康檢查調試日誌格式
log_format health_check_debug '$time_local | HEALTH_CHECK | '
                              'worker_pid: $pid | '
                              'loop_count: "$http_x_loop_count" | '
                              'check_duration: "$http_x_check_duration" | '
                              'debug_info: "$http_x_debug_info"';

# 資料庫調試日誌格式
log_format db_debug '$time_local | DATABASE | '
                    'operation: "$http_x_db_operation" | '
                    'table: "$http_x_db_table" | '
                    'duration: "$http_x_db_duration" | '
                    'debug_info: "$http_x_debug_info"';

# 調試日誌目錄
# 主要調試日誌
access_log /usr/local/openresty/nginx/logs/debug/main-debug.log debug_detailed;

# 健康檢查調試日誌
access_log /usr/local/openresty/nginx/logs/debug/health-check-debug.log health_check_debug;

# 資料庫調試日誌
access_log /usr/local/openresty/nginx/logs/debug/database-debug.log db_debug;

# 調試日誌緩衝設定
access_log /usr/local/openresty/nginx/logs/debug/combined-debug.log debug_detailed buffer=32k flush=5s;
